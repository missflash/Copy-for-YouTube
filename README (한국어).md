# 비디오 워크플로우 자동화 스크립트

[🇺🇸 English Documentation](README.md)

대용량 비디오 파일을 자동으로 관리하는 워크플로우 스크립트입니다. 상태 추적, 자동 복사, Discord 알림 기능을 제공합니다. 원래 YouTube 업로드 워크플로우를 위해 만들어졌지만, 다양한 미디어 관리 목적으로 활용할 수 있는 범용 도구입니다.

## 📋 목차
- [개요](#개요)
- [활용 사례](#활용-사례)
- [주요 기능](#주요-기능)
- [설치 및 설정](#설치-및-설정)
- [사용 방법](#사용-방법)
- [상태 라이프사이클](#상태-라이프사이클)
- [설정 참조](#설정-참조)
- [라이선스](#라이선스)

## 개요

이 Python 기반 자동화 스크립트는 소스 디렉토리에서 대용량 비디오 파일을 모니터링하고, 자동으로 타겟 디렉토리로 복사하며, SQLite 데이터베이스를 사용하여 처리 상태를 추적합니다. 또한 Discord 웹훅을 통해 요약 리포트를 선택적으로 전송할 수 있습니다. Synology와 같은 NAS 환경에 이상적이지만, 모든 Linux 기반 시스템에서 사용할 수 있습니다.

## 활용 사례

이 스크립트는 다양한 목적으로 활용할 수 있습니다:

### 1. **YouTube 업로드 워크플로우** (주요 용도)
비디오 파일을 YouTube 업로드를 위한 스테이징 영역으로 자동 복사하고, 업로드 진행 상황을 추적하며, 완료된 업로드를 관리합니다.

### 2. **대용량 파일 백업 자동화**
디렉토리에서 대용량 비디오 파일을 모니터링하고 백업 스토리지로 자동 복사하며, 모든 백업 작업의 완전한 감사 추적을 유지합니다.

### 3. **비디오 처리 파이프라인**
편집, 렌더링, 게시 단계를 거치면서 파일이 서로 다른 디렉토리를 통과하는 다단계 비디오 처리 워크플로우를 설정합니다.

### 4. **미디어 아카이브 관리**
대용량 미디어 파일이 활성 스토리지에서 아카이브 스토리지로 이동할 때 자동 감지 및 상태 추적을 통해 체계적으로 관리합니다.

### 5. **클라우드 스토리지 동기화 준비**
대용량 비디오 파일을 동기화 폴더에 스테이징하여 클라우드 업로드를 준비하고, 어떤 파일이 성공적으로 동기화되었는지 추적합니다.

### 6. **콘텐츠 배포 워크플로우**
완성된 비디오를 배포 폴더로 자동 복사하여 콘텐츠 배포를 관리하고, 각 파일이 어떤 플랫폼에 전달되었는지 추적합니다.

## 주요 기능

- **자동 파일 검색**: 크기 기준을 충족하는 비디오 파일을 소스 디렉토리에서 스캔 (기본: 100MB 이상)
- **설정 가능한 파일 형식**: 사용자 정의 파일 확장자 지원 (`.mp4`, `.mov`, `.avi` 등)
- **상태 관리**: SQLite 데이터베이스로 워크플로우 전체에서 파일 상태 추적
- **히스토리 추적**: 타임스탬프가 포함된 모든 상태 변경의 완전한 감사 추적
- **자동 디렉토리 생성**: 필요한 디렉토리가 없으면 자동 생성
- **Discord 통합**: 일일 요약 리포트를 위한 선택적 웹훅 알림
- **오류 처리**: 상세한 로깅과 함께 견고한 오류 처리
- **스케줄러 준비**: cron 또는 작업 스케줄러를 통한 실행 가능

## 설치 및 설정

### 사전 요구사항
- Python 3.x
- Bash 셸 (Linux/Unix 시스템용)
- SQLite3 (일반적으로 Python에 포함됨)

### 1단계: 프로젝트 다운로드
이 저장소를 시스템에 클론하거나 다운로드합니다.

### 2단계: 설정 구성
1. `config(base).json` 파일의 이름을 `config.json`으로 변경
2. 특정 경로와 설정으로 `config.json` 편집:

```json
{
    "source_dir": "/소스/폴더/경로",
    "upload_dir": "/타겟/폴더/경로",
    "completed_dir": "/완료/폴더/경로",
    "db_path": "/데이터베이스/경로/video_workflow.db",
    "min_size_mb": 100,
    "webhook_url": "https://discord.com/api/webhooks/웹훅_URL",
    "extensions": [".mp4", ".mov", ".MP4", ".MOV"]
}
```

**설정 옵션:**
- `source_dir`: 새 비디오 파일을 모니터링할 디렉토리
- `upload_dir`: 파일이 복사될 타겟 디렉토리
- `completed_dir`: 처리된 파일이 이동되는 디렉토리
- `db_path`: SQLite 데이터베이스 파일 경로
- `min_size_mb`: 처리할 최소 파일 크기 (MB 단위, 기본값: 100)
- `webhook_url`: Discord 웹훅 URL (선택 사항)
- `extensions`: 모니터링할 파일 확장자 목록

**중요:** `config.json` 파일은 민감한 정보를 보호하기 위해 git에서 제외됩니다 (`.gitignore` 포함).

### 3단계: 권한 설정
셸 스크립트를 실행 가능하게 만들기:

```bash
chmod +x copy_for_youtube.sh
# 또는
chmod 755 copy_for_youtube.sh
```

### 4단계: 파일 구조 확인
`copy_for_youtube.py`와 `copy_for_youtube.sh`가 동일한 디렉토리에 있는지 확인 (셸 스크립트가 상대 경로 사용).

## 사용 방법

### 수동 실행

#### 표준 실행
새 파일을 스캔하고 복사 작업 수행:
```bash
bash /경로/copy_for_youtube.sh
```

#### 알림이 포함된 리포트 실행
워크플로우 실행 및 Discord로 요약 전송:
```bash
bash /경로/copy_for_youtube.sh notify
```

### 자동 스케줄링

#### Cron 사용 (Linux/Unix)
crontab에 추가 (`crontab -e`):

```bash
# 30분마다 실행
*/30 * * * * bash /경로/copy_for_youtube.sh

# 매일 새벽 2시에 일일 리포트 전송
0 2 * * * bash /경로/copy_for_youtube.sh notify
```

#### Synology 작업 스케줄러 사용
1. 제어판 → 작업 스케줄러 열기
2. 생성 → 예약된 작업 → 사용자 정의 스크립트
3. 일정: 원하는 빈도 설정
4. 작업 설정 → 사용자 정의 스크립트:
   ```bash
   bash /경로/copy_for_youtube.sh
   ```

## 상태 라이프사이클

스크립트는 각 파일에 대해 세 가지 상태를 관리합니다:

| 상태 | 설명 | 트리거 |
|------|------|--------|
| **0 (New)** | 소스 디렉토리에서 파일 발견, 크기 기준 충족 | 자동 스캔 |
| **1 (Copied)** | 타겟 디렉토리로 파일 복사 완료 | 복사 작업 후 |
| **2 (Completed)** | 완료 디렉토리에서 파일 발견, 처리 완료 | 완료 디렉토리로 파일 이동 |

### 워크플로우 다이어그램
```
[소스 디렉토리] → 상태 0 (New) 
    ↓ (자동 복사)
[업로드 디렉토리] → 상태 1 (Copied)
    ↓ (수동/외부 프로세스)
[완료 디렉토리] → 상태 2 (Completed)
```

## 설정 참조

### 디렉토리 구조 예시
```
/volume1/video/
├── raw/              # source_dir - 새 녹화 파일
├── upload/           # upload_dir - 처리 준비 완료
├── completed/        # completed_dir - 완료된 파일
└── workflow.db       # db_path - SQLite 데이터베이스
```

### 데이터베이스 스키마
```sql
CREATE TABLE files (
    filepath TEXT PRIMARY KEY,
    filename TEXT,
    status INTEGER DEFAULT 0,
    detected_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    history TEXT DEFAULT ''
);
```

### Discord 알림 형식
`notify` 매개변수 사용 시, 스크립트는 다음 내용을 포함하는 Discord 임베드를 전송합니다:
- 발견된 새 파일 (24시간)
- 업로드 디렉토리로 복사된 파일 (24시간)
- 완료로 표시된 파일 (24시간)
- 상태별 전체 데이터베이스 통계

## 문제 해결

### 일반적인 문제

**문제:** 스크립트가 새 파일을 찾지 못함
- `source_dir` 경로가 올바른지 확인
- 파일 크기가 `min_size_mb` 임계값을 충족하는지 확인
- 파일 확장자가 `extensions` 목록과 일치하는지 확인

**문제:** 복사 작업 실패
- `upload_dir`에 대한 쓰기 권한 확인
- 충분한 디스크 공간 확인
- 콘솔 출력의 오류 메시지 검토

**문제:** Discord 알림이 작동하지 않음
- `webhook_url`이 유효한지 확인
- 웹훅 URL을 수동으로 테스트
- 네트워크 연결 확인

## 라이선스

이 프로젝트는 Apache License 2.0에 따라 라이선스가 부여됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

## 기여

기여 프로세스에 대한 자세한 내용은 [CONTRIBUTING.md](CONTRIBUTING.md)를 읽어주세요.
